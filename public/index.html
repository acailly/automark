<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>

    <script>
      
      proxifyAddEventListener(myProxy)
      listenAllDocumentEvents()

      function myProxy(event){
        if(event.type === 'click'){

          //Get the xpath
          var xpath = getPathTo(event.target)
          console.log('CLICK', xpath)

          //Find the element from the xpath
          var element = document.evaluate( xpath ,document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null ).singleNodeValue
          if (!element) return
          console.log('FOUND', element)

          //Show click on the element
          eventFire(element, 'mousedown')

          var rect = element.getBoundingClientRect();
          var x = rect.left + (rect.right - rect.left) / 2
          var y = rect.top + (rect.bottom - rect.top) /2
          showClick(x, y)
        }
        else if(event.type === 'mousedown'){
          console.log('MOUSE DOWN!')
        }
      }

      function proxifyAddEventListener(listenerProxy){
        var oldAddEventListener = EventTarget.prototype.addEventListener
        function addEventListenerEx(){
            var argumentsEx = []
            for(var i=0; i<arguments.length; i++){
              argumentsEx[i] = arguments[i]
            }

            var oldListener = arguments[1]
            var listenerEx = function(){
              listenerProxy.apply(this, arguments)
              oldListener.apply(this, arguments)
            }
            argumentsEx[1] = listenerEx

            oldAddEventListener.apply(this, argumentsEx)
        }
        EventTarget.prototype.addEventListener = addEventListenerEx
      }

      function listenAllDocumentEvents(){
        /*

        function getAllEventTypes(){

          if(location.href !='https://developer.mozilla.org/en-US/docs/Web/Events') return;

          var types = {};
          $('.standard-table:eq(0) tr').find('td:eq(1)').map(function(){
            var type = $.trim(this.innerText) || 'OtherEvent';
            types[type] = types[type] || [];     
            var event = $.trim(this.previousElementSibling.innerText);
            if(event) types[type].push(event);
          });
          for(var t in types) types[t] = types[t].join(' ');
          return "var DOMEvents = "+JSON.stringify(types, null, 4).replace(/"(\w+)\":/ig, '$1:');
        }

        */

        var DOMEvents = {
        UIEvent: "abort DOMActivate error load resize scroll select unload",
        ProgressEvent: "abort error load loadend loadstart progress progress timeout",
        Event: "abort afterprint beforeprint cached canplay canplaythrough change chargingchange chargingtimechange checking close dischargingtimechange DOMContentLoaded downloading durationchange emptied ended ended error error error error fullscreenchange fullscreenerror input invalid languagechange levelchange loadeddata loadedmetadata noupdate obsolete offline online open open orientationchange pause pointerlockchange pointerlockerror play playing ratechange readystatechange reset seeked seeking stalled submit success suspend timeupdate updateready visibilitychange volumechange waiting",
        AnimationEvent: "animationend animationiteration animationstart",
        AudioProcessingEvent: "audioprocess",
        BeforeUnloadEvent: "beforeunload",
        TimeEvent: "beginEvent endEvent repeatEvent",
        OtherEvent: "blocked complete upgradeneeded versionchange",
        FocusEvent: "blur DOMFocusIn  Unimplemented DOMFocusOut  Unimplemented focus focusin focusout",
        MouseEvent: "click contextmenu dblclick mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup show",
        SensorEvent: "compassneedscalibration Unimplemented userproximity",
        OfflineAudioCompletionEvent: "complete",
        CompositionEvent: "compositionend compositionstart compositionupdate",
        ClipboardEvent: "copy cut paste",
        DeviceLightEvent: "devicelight",
        DeviceMotionEvent: "devicemotion",
        DeviceOrientationEvent: "deviceorientation",
        DeviceProximityEvent: "deviceproximity",
        MutationNameEvent: "DOMAttributeNameChanged DOMElementNameChanged",
        MutationEvent: "DOMAttrModified DOMCharacterDataModified DOMNodeInserted DOMNodeInsertedIntoDocument DOMNodeRemoved DOMNodeRemovedFromDocument DOMSubtreeModified",
        DragEvent: "drag dragend dragenter dragleave dragover dragstart drop",
        GamepadEvent: "gamepadconnected gamepaddisconnected",
        HashChangeEvent: "hashchange",
        KeyboardEvent: "keydown keypress keyup",
        MessageEvent: "message message message message",
        PageTransitionEvent: "pagehide pageshow",
        PopStateEvent: "popstate",
        StorageEvent: "storage",
        SVGEvent: "SVGAbort SVGError SVGLoad SVGResize SVGScroll SVGUnload",
        SVGZoomEvent: "SVGZoom",
        TouchEvent: "touchcancel touchend touchenter touchleave touchmove touchstart",
        TransitionEvent: "transitionend",
        WheelEvent: "wheel"
        }

        var RecentlyLoggedDOMEventTypes = {};

        for(DOMEvent in DOMEvents){

          var DOMEventTypes = DOMEvents[DOMEvent].split(' ');

          DOMEventTypes.filter(function(DOMEventType){
            var DOMEventCategory = DOMEvent + ' '+DOMEventType;  
            document.addEventListener(DOMEventType, function(e){
              // if(RecentlyLoggedDOMEventTypes[DOMEventCategory]) return;
              // RecentlyLoggedDOMEventTypes[DOMEventCategory] = true;
              // setTimeout(function(){ RecentlyLoggedDOMEventTypes[DOMEventCategory] = false }, 5000);
              // var isActive = e.target==document.activeElement;
              // if(isActive) {
              //   console.info(DOMEventCategory, 
              //     ' target=', e.target, 
              //     ' active=', document.activeElement, 
              //     ' isActive=', true );
              // } else {
              //   console.log(DOMEventCategory, 
              //     ' target=', e.target,
              //     ' active=', document.activeElement, 
              //     ' isActive=', false );
              // }

            }, true);
          });

        }
      }

      function getPathTo(element) {
        if (element.id!=='')
            return "//*[@id='"+element.id+"']";
        
        if (element===document.body)
            return element.tagName.toLowerCase();

        var ix= 0;
        var siblings= element.parentNode.childNodes;
        for (var i= 0; i<siblings.length; i++) {
          var sibling= siblings[i];
          
          if (sibling===element) return getPathTo(element.parentNode) + '/' + element.tagName.toLowerCase() + '[' + (ix + 1) + ']';
          
          if (sibling.nodeType===1 && sibling.tagName === element.tagName) {
              ix++;
          }
        }
      }

      function eventFire(el, etype){
        if (el.fireEvent) {
          el.fireEvent('on' + etype)
        } else {
          var evObj = document.createEvent('Events')
          evObj.initEvent(etype, true, false)
          el.dispatchEvent(evObj)
        }
      }

      function showClick(x, y) {
        var clickSignal = document.createElement('div')
        clickSignal.style.zIndex = 2000
        clickSignal.style.border = "3px solid red"
        clickSignal.style['border-radius'] = '50%' // Chrome
        clickSignal.style.borderRadius = '50%'     // Mozilla
        clickSignal.style.width = "40px"
        clickSignal.style.height = "40px"
        clickSignal.style['box-sizing'] = 'border-box'
        clickSignal.style.position = "absolute"
        clickSignal.style.webkitTransition = 'opacity 1s ease-out'
        clickSignal.style.mozTransition = 'opacity 1s ease-out'
        clickSignal.style.transition = 'opacity 1s ease-out'
        clickSignal.style.left = (x - 20 ) + 'px'
        clickSignal.style.top = (y - 20 )+ 'px'
        var element = document.body.appendChild(clickSignal)
        setTimeout(function() {
          document.body.removeChild(element)
        }, 1000)
        setTimeout(function() {
          element.style.opacity = 0
        }, 50)
      }

    </script>
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
